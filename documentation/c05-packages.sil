\begin{document}
\chapter{SILE Packages}

SILE comes with a number of standard packages which provide additional functionality.
In fact, the actual “core” of SILE’s functionality is small and extensible, with most of the interesting features being provided by add-on packages.
SILE packages are written in the Lua programming language, and can define new commands, change the way that the SILE system operates, or indeed do anything that is possible to do in Lua.

\section{Loading a package}

Loading a package is done through the \code{\\use} command.
By convention packages live in a \code{packages/}
For instance, we’ll soon be talking about the \autodoc:package{grid} package, which normally can be found as \code{/usr/local/lib/sile/packages/grid/init.lua}.
To load this, we’d say:

\begin[type=autodoc:codeblock]{raw}
\use[module=packages.grid]
\end{raw}

\autodoc:note{
By default SILE will look for packages in a variety of directories:

\begin{enumerate}
\item{The directory where your input source file is located.}
\item{The current working directory.}
\item{The environment variable \code{SILE_PATH}, if defined.}
\item{The default Lua search path.}
\item{The directories where SILE is installed on the system, \code{/usr/lib/sile} and
\code{/usr/local/lib/sile}.}
\end{enumerate}

SILE does not descend into subdirectories when looking for a file.
If you have arranged your personal class or package files into subdirectories,
you will need to provide a full relative path to them.}

\section{The SILE ecosystem}

The SILE installation includes a core collection of modules we hope are generally useful.
But there’s more out there!
As mentioned earlier in this manual, a number of third-party contributed collections of modules can be installed via the LuaRocks package manager.

\autodoc:note{
A non-authoritative list of third-party modules may be consulted at \url{https://luarocks.org/m/sile}. To publish your own modules to LuaRocks, see the \code{package-template.sile} repository.
}

A SILE compatible LuaRock simply installs the relevant class, package, language, internationalization resources, or similar files in a \code{sile} directory.
This directory could be in your system Lua directory, in your user directory, or any other location you specify.

By default, LuaRocks will install these modules to the Lua search path.

\begin[type=autodoc:codeblock]{raw}
$ luarocks install markdown.sile
$ sile ...
\end{raw}

Depending on your system, this probably requires root permissions.
If you either don’t have root permissions or don’t want to pollute your system’s root file system, you can also install as a user.
To use packages installed as a user you will need to have LuaRocks add its user tree to your Lua search path before running SILE.

\begin[type=autodoc:codeblock]{raw}
$ luarocks --local install markdown.sile
$ eval $(luarocks --local path)
$ sile ...
\end{raw}

Of course, you can add that eval statement to your shell profile to always include your user directory in your Lua path.
You can also add your own entries to the top of the search path list by setting the \code{SILE_PATH} variable. For example:

\begin[type=autodoc:codeblock]{raw}
$ export SILE_PATH="/path/to/my/library/"
$ sile ...
\end{raw}

Note that modules are not limited to just packages.
They can include classes, languages, internationalization resources, or anything else provided by SILE.\footnote{%
Also because external locations are searched before SILE itself, they can even override any core part of SILE itself.
As such you should probably make sure you review what a package does before installing it!}

\use[module=packages.unichar]
\define[command=xxx]{\font[family=Cormorant Infant]{\unichar{U+261E}} \em{\process}\par\noindent}

\section{Graphics}

As well as processing text, SILE can also include images.

\subsection{image}
\package-documentation{image}

\subsection{svg}
\package-documentation{svg}

\subsection{converters}
\package-documentation{converters}

\section{Text & Characters}

\subsection{dropcaps}
\package-documentation{dropcaps}

\subsection{lorem}
\package-documentation{lorem}

\subsection{textcase}
\package-documentation{textcase}

\subsection{unichar}
\package-documentation{unichar}

\subsection{url}
\package-documentation{url}

\subsection{gutenberg}
\package-documentation{gutenberg}

\section{Colors}

\subsection{color}
\package-documentation{color}

\subsection{background}
\package-documentation{background}

\section{Fillers & Rules}

\subsection{leaders}
\package-documentation{leaders}

\subsection{rules}
\package-documentation{rules}

\section{Boxes & Effects}

\subsection{raiselower}
\package-documentation{raiselower}

\subsection{rebox}
\package-documentation{rebox}

\subsection{rotate}
\package-documentation{rotate}

\subsection{scalebox}
\package-documentation{scalebox}

\section{Mathematical formulas}
\package-documentation{math}

\section{Specialized environments}

\subsection{lists}
\package-documentation{lists}

\subsection{pullquote}
\package-documentation{pullquote}

\subsection{verbatim}
\package-documentation{verbatim}

\subsection{specimen}
\package-documentation{specimen}

\subsection{boustrophedon}
\package-documentation{boustrophedon}

\subsection{chordmode}
\package-documentation{chordmode}

\section{Advanced font features}

The following packages leverage SILE’s font default handling and the \autodoc:command{\font} command with new capabilities.

\subsection{features}
\package-documentation{features}

\subsection{font-fallback}
\package-documentation{font-fallback}

\section{Advanced line-spacing}

\subsection{grid}
\package-documentation{grid}

\subsection{linespacing}
\package-documentation{linespacing}

\section{Document parts}

\subsection{folio}
\package-documentation{folio}

\subsection{footnotes}
\package-documentation{footnotes}

\subsection{tableofcontents}
\package-documentation{tableofcontents}

\section{Bibliographies, indexes, etc.}

\subsection{bibtex}
\package-documentation{bibtex}

\subsection{indexer}
\package-documentation{indexer}

\section{Minor utilities}

\subsection{date}
\package-documentation{date}

\subsection{debug}
\package-documentation{debug}

\subsection{ifattop}
\package-documentation{ifattop}

\section{Frames and page layouts}

\subsection{cropmarks}
\package-documentation{cropmarks}

\subsection{frametricks}
\package-documentation{frametricks}

\subsection{twoside}
\package-documentation{twoside}

\subsection{masters}
\package-documentation{masters}

\subsection{break-firstfit}
\package-documentation{break-firstfit}

\subsection{balanced-frames}
\package-documentation{balanced-frames}
\section{Low-level internal packages}

In addition, there are certain packages that you \em{probably} don’t need
to use directly, as their main job is to provide more
basic functionality to other packages and classes. Classes such as the
\code{book} class compose functionality from different auxiliary packages.

\subsection{bidi}
\package-documentation{bidi}

\subsection{color-fonts}
\package-documentation{color-fonts}

\subsection{counters}
\package-documentation{counters}

\subsection{insertions}
\package-documentation{insertions}

\subsection{infonode}
\package-documentation{infonode}

\subsection{inputfilter}
\package-documentation{inputfilter}

\subsection{chapterverse}
\package-documentation{chapterverse}

\subsection{parallel}
\package-documentation{parallel}

\subsection{autodoc}
\package-documentation{autodoc}

\subsection{pdf}
\package-documentation{pdf}

\subsection{pdfstructure}
\package-documentation{pdfstructure}

\section{Highly experimental packages}

\autodoc:note{These packages are not ready for use in production and are subject to change without notice in future versions.}

The following packages are not documented here:
\autodoc:package{complex-spaces},
\autodoc:package{pagebuilder-bestfit},
\autodoc:package{pandoc},
\autodoc:package{simpletable},
\autodoc:package{xmltricks}.

\end{document}
